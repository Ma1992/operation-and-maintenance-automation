(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06a28230","chunk-2d0aa9b6","chunk-081d6fe4"],{1166:function(t,e,a){},1276:function(t,e,a){"use strict";var l=a("d784"),r=a("44e7"),i=a("825a"),o=a("1d80"),n=a("4840"),s=a("8aa5"),c=a("50c4"),u=a("14c3"),p=a("9263"),h=a("d039"),f=[].push,m=Math.min,d=4294967295,b=!h((function(){return!RegExp(d,"y")}));l("split",2,(function(t,e,a){var l;return l="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,a){var l=String(o(this)),i=void 0===a?d:a>>>0;if(0===i)return[];if(void 0===t)return[l];if(!r(t))return e.call(l,t,i);var n,s,c,u=[],h=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),m=0,b=new RegExp(t.source,h+"g");while(n=p.call(b,l)){if(s=b.lastIndex,s>m&&(u.push(l.slice(m,n.index)),n.length>1&&n.index<l.length&&f.apply(u,n.slice(1)),c=n[0].length,m=s,u.length>=i))break;b.lastIndex===n.index&&b.lastIndex++}return m===l.length?!c&&b.test("")||u.push(""):u.push(l.slice(m)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(t,a){return void 0===t&&0===a?[]:e.call(this,t,a)}:e,[function(e,a){var r=o(this),i=void 0==e?void 0:e[t];return void 0!==i?i.call(e,r,a):l.call(String(r),e,a)},function(t,r){var o=a(l,t,this,r,l!==e);if(o.done)return o.value;var p=i(t),h=String(this),f=n(p,RegExp),g=p.unicode,_=(p.ignoreCase?"i":"")+(p.multiline?"m":"")+(p.unicode?"u":"")+(b?"y":"g"),v=new f(b?p:"^(?:"+p.source+")",_),y=void 0===r?d:r>>>0;if(0===y)return[];if(0===h.length)return null===u(v,h)?[h]:[];var w=0,x=0,k=[];while(x<h.length){v.lastIndex=b?x:0;var S,$=u(v,b?h:h.slice(x));if(null===$||(S=m(c(v.lastIndex+(b?0:x)),h.length))===w)x=s(h,x,g);else{if(k.push(h.slice(w,x)),k.length===y)return k;for(var I=1;I<=$.length-1;I++)if(k.push($[I]),k.length===y)return k;x=w=S}}return k.push(h.slice(w)),k}]}),!b)},"1f82":function(t,e,a){"use strict";e["a"]={name:"ElCol",props:{span:{type:Number,default:24},tag:{type:String,default:"div"},offset:Number,pull:Number,push:Number,xs:[Number,Object],sm:[Number,Object],md:[Number,Object],lg:[Number,Object],xl:[Number,Object]},computed:{gutter(){let t=this.$parent;while(t&&"ElRow"!==t.$options.componentName)t=t.$parent;return t?t.gutter:0}},render(t){let e=[],a={};return this.gutter&&(a.paddingLeft=this.gutter/2+"px",a.paddingRight=a.paddingLeft),["span","offset","pull","push"].forEach(t=>{(this[t]||0===this[t])&&e.push("span"!==t?`el-col-${t}-${this[t]}`:"el-col-"+this[t])}),["xs","sm","md","lg","xl"].forEach(t=>{if("number"===typeof this[t])e.push(`el-col-${t}-${this[t]}`);else if("object"===typeof this[t]){let a=this[t];Object.keys(a).forEach(l=>{e.push("span"!==l?`el-col-${t}-${l}-${a[l]}`:`el-col-${t}-${a[l]}`)})}}),t(this.tag,{class:["el-col",e],style:a},this.$slots.default)}}},"45fc":function(t,e,a){"use strict";var l=a("23e7"),r=a("b727").some,i=a("a640"),o=a("ae40"),n=i("some"),s=o("some");l({target:"Array",proto:!0,forced:!n||!s},{some:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,a){var l=a("1d80"),r=a("5899"),i="["+r+"]",o=RegExp("^"+i+i+"*"),n=RegExp(i+i+"*$"),s=function(t){return function(e){var a=String(l(e));return 1&t&&(a=a.replace(o,"")),2&t&&(a=a.replace(n,"")),a}};t.exports={start:s(1),end:s(2),trim:s(3)}},7156:function(t,e,a){var l=a("861d"),r=a("d2bb");t.exports=function(t,e,a){var i,o;return r&&"function"==typeof(i=e.constructor)&&i!==a&&l(o=i.prototype)&&o!==a.prototype&&r(t,o),t}},a434:function(t,e,a){"use strict";var l=a("23e7"),r=a("23cb"),i=a("a691"),o=a("50c4"),n=a("7b0b"),s=a("65f0"),c=a("8418"),u=a("1dde"),p=a("ae40"),h=u("splice"),f=p("splice",{ACCESSORS:!0,0:0,1:2}),m=Math.max,d=Math.min,b=9007199254740991,g="Maximum allowed length exceeded";l({target:"Array",proto:!0,forced:!h||!f},{splice:function(t,e){var a,l,u,p,h,f,_=n(this),v=o(_.length),y=r(t,v),w=arguments.length;if(0===w?a=l=0:1===w?(a=0,l=v-y):(a=w-2,l=d(m(i(e),0),v-y)),v+a-l>b)throw TypeError(g);for(u=s(_,l),p=0;p<l;p++)h=y+p,h in _&&c(u,p,_[h]);if(u.length=l,a<l){for(p=y;p<v-l;p++)h=p+l,f=p+a,h in _?_[f]=_[h]:delete _[f];for(p=v;p>v-l+a;p--)delete _[p-1]}else if(a>l)for(p=v-l;p>y;p--)h=p+l-1,f=p+a-1,h in _?_[f]=_[h]:delete _[f];for(p=0;p<a;p++)_[p+y]=arguments[p+2];return _.length=v-l+a,u}})},a9e3:function(t,e,a){"use strict";var l=a("83ab"),r=a("da84"),i=a("94ca"),o=a("6eeb"),n=a("5135"),s=a("c6b6"),c=a("7156"),u=a("c04e"),p=a("d039"),h=a("7c73"),f=a("241c").f,m=a("06cf").f,d=a("9bf2").f,b=a("58a8").trim,g="Number",_=r[g],v=_.prototype,y=s(h(v))==g,w=function(t){var e,a,l,r,i,o,n,s,c=u(t,!1);if("string"==typeof c&&c.length>2)if(c=b(c),e=c.charCodeAt(0),43===e||45===e){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===e){switch(c.charCodeAt(1)){case 66:case 98:l=2,r=49;break;case 79:case 111:l=8,r=55;break;default:return+c}for(i=c.slice(2),o=i.length,n=0;n<o;n++)if(s=i.charCodeAt(n),s<48||s>r)return NaN;return parseInt(i,l)}return+c};if(i(g,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var x,k=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof k&&(y?p((function(){v.valueOf.call(a)})):s(a)!=g)?c(new _(w(e)),a,k):w(e)},S=l?f(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),$=0;S.length>$;$++)n(_,x=S[$])&&!n(k,x)&&d(k,x,m(_,x));k.prototype=v,v.constructor=k,o(r,g,k)}},c979:function(t,e,a){"use strict";var l=a("1166"),r=a.n(l);r.a},d81d:function(t,e,a){"use strict";var l=a("23e7"),r=a("b727").map,i=a("1dde"),o=a("ae40"),n=i("map"),s=o("map");l({target:"Array",proto:!0,forced:!n||!s},{map:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},f136:function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}})],1),a("div",{staticClass:"container"},[a("el-form",{ref:"form",attrs:{inline:!0,model:t.form,rules:t.rules,"label-width":"100px"}},[a("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[a("el-form-item",{attrs:{label:"巡检任务:",prop:"patrol"}},[a("el-select",{attrs:{placeholder:"请选择巡检任务",clearable:""},on:{focus:t.getPatrol},model:{value:t.form.patrol,callback:function(e){t.$set(t.form,"patrol",e)},expression:"form.patrol"}},t._l(t.patrolData,(function(t){return a("el-option",{key:t.id,attrs:{label:t.patrol_name,value:t.start_time+"/"+t.end_time+"/"+t.script[0]+"/"+t.id}})})),1)],1)],1),a("el-row",{attrs:{span:15}},[a("el-form-item",{attrs:{label:"汇总:",prop:"param",labelWidth:"120"}},[t._v(" 已选 "),a("label",{staticClass:"blue"},[t._v(t._s(t.rowLength))]),t._v(" 台 ")])],1),a("el-row",{attrs:{span:9}},[a("el-button",{staticClass:"el-icon-circle-plus-outline",attrs:{type:"primary",plain:""},on:{click:t.handleAddHost}},[t._v("添加主机")]),a("el-button",{staticClass:"el-icon-caret-right",attrs:{type:"success",plain:"",disabled:t.disabled},on:{click:t.handleExecScript}},[t._v("执行")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableDataSelect,border:"","max-height":"600"}},[a("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),a("el-table-column",{attrs:{prop:"hostname",label:"主机名称",align:"center"}}),a("el-table-column",{attrs:{prop:"network_ip",label:"内网IP",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"类型",align:"center"}}),a("el-table-column",{attrs:{prop:"username",label:"用户名",align:"center"}}),a("el-table-column",{attrs:{prop:"password",label:"密码",align:"center"}}),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1)],1),a("el-dialog",{attrs:{title:"添加主机",visible:t.addHostVisible,width:"70%"},on:{"update:visible":function(e){t.addHostVisible=e}}},[a("el-form",{ref:"host_form",attrs:{inline:!0,model:t.host_form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择主机:",prop:"room_type"}},[a("el-select",{attrs:{placeholder:"机房分类",clearable:""},model:{value:t.host_form.room_type,callback:function(e){t.$set(t.host_form,"room_type",e)},expression:"host_form.room_type"}},t._l(t.room_type_options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1),a("el-form-item",[a("el-input",{staticStyle:{width:"200px","margin-bottom":"15px"},attrs:{type:"text",placeholder:"请输入主机名",clearable:""},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}})],1),a("el-button",{on:{click:t.handleSearch}},[t._v("查询")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"","max-height":"600"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",selectable:t.selectable}}),a("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),a("el-table-column",{attrs:{prop:"hostname",label:"主机名称",align:"center"}}),a("el-table-column",{attrs:{label:"内网IP",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{placeholder:"请选择内网ip"},on:{focus:function(a){return t.getNetworkIp(e.row)}},model:{value:e.row.network_ip,callback:function(a){t.$set(e.row,"network_ip",a)},expression:"host_scope.row.network_ip"}},t._l(t.network_ip_option,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"type",label:"类型",align:"center"}}),a("el-table-column",{attrs:{prop:"username",label:"用户名",align:"center"}}),a("el-table-column",{attrs:{prop:"password",label:"密码",align:"center"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.addHostVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.addHost}},[t._v("添 加")])],1)],1),a("el-dialog",{attrs:{title:"执行方式",visible:t.CrontabVisible,width:"55%"},on:{"update:visible":function(e){t.CrontabVisible=e}}},[a("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"选择执行方式：",prop:"exec_type"}},[a("el-select",{staticStyle:{width:"320px"},attrs:{placeholder:"请选择任务执行方式"},model:{value:t.form.exec_type,callback:function(e){t.$set(t.form,"exec_type",e)},expression:"form.exec_type"}},t._l(t.exec_type_options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.label}})})),1)],1),"周期性执行"===t.form.exec_type?a("el-form-item",{attrs:{label:"输入执行时间：",prop:"cron_exec_time"}},[a("el-input",{staticStyle:{width:"320px"},attrs:{placeholder:"请输入执行时间"},on:{blur:t.checkDate},model:{value:t.form.cron_exec_time,callback:function(e){t.$set(t.form,"cron_exec_time",e)},expression:"form.cron_exec_time"}}),a("el-row",{staticClass:"cron_time_color"},[t._v("格式:分 时 日 月 年,以空格间隔")]),a("el-row",{staticClass:"cron_exec_time"},[a("el-col",[t._v("周期性执行执行时间采用Cron表达式:")]),a("ul",[a("li",[t._v("逗号（“ , “）分开的值，例如：“1,3,4,7,8”")]),a("li",[t._v("连词符（“ - “）指定值的范围，例如：“1-6”，意思等同于“1,2,3,4,5,6”")]),a("li",[t._v("星号（“ * “）代表任何可能的值。例如，在“小时域”里的星号等于是“每一个小时”")]),a("li",[t._v("斜线（“ / “）操作符，用于表示跳过某些给定的数。例如，“*/3”在小时域中等于“0,3,6,9,12,15,18,21”等被3整除的数")])])],1)],1):t._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.CrontabVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.timingExecScript}},[t._v("确 定")])],1)],1),a("el-dialog",{staticClass:"row-bg",attrs:{title:"执行",visible:t.immediateExecVisible,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(e){t.immediateExecVisible=e}}},t._l(t.scriptMessage,(function(e){return a("el-row",{key:e},[a("el-col",{staticStyle:{"margin-top":"10px"},attrs:{span:24}},[a("span",[t._v(t._s(e))])])],1)})),1)],1)},r=[],i=(a("99af"),a("d81d"),a("45fc"),a("a434"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("25f0"),a("1276"),a("1f82")),o=(a("424b"),{components:{ElCol:i["a"]},name:"roletable",data:function(){return{options:[],addHostVisible:!1,CrontabVisible:!1,ExecVisible:!1,immediateExecVisible:!1,network_ip_option:[],menuProps:{value:"id",label:"name",multiple:!0},keywords:"",query:{address:"",name:"",pageIndex:1,pageSize:10},tableData:[],patrolData:[],tableDataSelect:[],multipleSelection:[],delList:[],disabled:!0,title:"",name:"",startFormatDate:"",endFormatDate:"",scriptLogMessage:{execute_res:""},wsUrl:"",scriptMessage:[],pageTotal:0,form:{},host_form:{},host:{},idx:-1,id:-1,room_type_options:[{value:"选项1",label:"公司机房"},{value:"选项2",label:"外部机房"}],exec_type_options:[{value:"选项2",label:"周期性执行"}],rules:{patrol:[{required:!0,message:"请选择巡检任务",trigger:"change"}]},rowLength:0}},created:function(){this.token=localStorage.getItem("token"),this.username=localStorage.getItem("username")},methods:{getData:function(){var t=this,e=this.keywords,a=this.url;a=e?"asset/api/network/network_type?hostname=".concat(e):"asset/api/network/network_type/",this.$http.get(a,{headers:{token:this.token}}).then((function(e){e.data.map((function(t){t["network_ip"]=t["network_ip"][0]})),t.tableData=e.data})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))},getNetworkIp:function(t){var e=this;this.$http.get("asset/api/network/network_type?hostname=".concat(t.hostname),{headers:{token:this.token}}).then((function(t){e.network_ip_option=t.data[0]["network_ip"]})).catch((function(t){e.$message.error(JSON.stringify(t.response.data))}))},getPatrol:function(){var t=this,e="未执行";this.$http.get("automation/api/patrol/?status=".concat(e),{headers:{token:localStorage.getItem("token")}}).then((function(e){console.log(e.data,111),console.log(e.status,222),e&&(t.patrolData=e.data)})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))},handleAddHost:function(){this.addHostVisible=!0,this.getData()},addHost:function(){0===this.tableDataSelect.length?this.tableDataSelect=this.multipleSelection:this.tableDataSelect=this.tableDataSelect.concat(this.multipleSelection),this.addHostVisible=!1,this.disabled=!1,this.rowLength=this.tableDataSelect.length},handleSearch:function(){this.$set(this.query,"pageIndex",1),this.getData()},handleDelete:function(t){this.tableDataSelect.splice(t,1),0===this.tableDataSelect.length&&(this.disabled=!0),this.rowLength=this.tableDataSelect.length},handleSelectionChange:function(t){this.multipleSelection=t},genID:function(t){return Number(Math.random().toString().substr(3,t)+Date.now()).toString(36)},handleExecScript:function(){var t=this.form.patrol.split("/")[1];(new Date).getTime()<new Date(t).getTime()?this.CrontabVisible=!0:this.$message.error("执行失败！巡检任务结束时间已过!")},execScript:function(){this.form.script_name?this.tableDataSelect.length>1?this.$message.warning("单机执行，只能选择一台主机！"):(this.form.host_info=this.tableDataSelect,this.form.uuid=this.genID(),this.form.username=this.username,this.scriptMessage=[],this.immediateExecVisible=!0,this.wsUrl=this.globalAPI.websocketUrl+"ws/immediate_exec_script/",this.initWebSocket()):this.$message.warning("请选择脚本名称！")},checkDate:function(){var t=/^([0-9-,/*]+)\s([0-9-,/*]+)\s([0-9-,/*]+)\s([0-9-,/*]+)\s([0-9-,/*]+)$/;return!1!==t.test(this.form.cron_exec_time)||(this.$message.warning("执行时间格式不正确！"),!1)},checkTime:function(){var t=/^([0-1]?[0-9]|2[0-3])\/([0-5][0-9])\/([0-5][0-9])$/;return!1!==t.test(this.form.interval_exec_time)||(this.$message.warning("执行时间格式不正确！"),!1)},timingExecScript:function(){var t=this;if("周期性执行"===this.form.exec_type){if(!1===this.checkDate())return}else if("周期性执行"===this.form.exec_type&&!1===this.checkTime())return;this.form.host_info=this.tableDataSelect,this.form.uuid=this.genID(),console.log(this.form.patrol,123),this.form.patrol=this.form.patrol.split("/"),console.log(this.form.patrol,234),this.form.start_time=this.form.patrol[0],this.form.end_time=this.form.patrol[1],this.form.patrol_id=this.form.patrol[3];var e=this.form.patrol[2];console.log(e,999),this.$http.get("automation/api/script/?id=".concat(e),{headers:{token:this.token}}).then((function(e){var a=e.data[0];t.form.id=a.id,t.form.script_name=a.script_name,t.form.script_type=a.script_type,t.form.category=a.category,t.form.content=a.content,t.form.desc=a.desc,t.form.use=a.use,t.form.param=a.param,t.form.test_status=a.test_status,t.form.ef_time=a.ef_time,console.log(t.form,888),t.$refs.form.validate((function(e){if(!e)return t.$message.warning("请选择必填项"),!1;t.$http.post("automation/api/script/timing_exec_script/",t.form,{headers:{token:t.token,username:t.username}}).then((function(e){console.log(123456),t.CrontabVisible=!1,t.$message.success(e.data.msg)})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))}))})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))},delAllSelection:function(){var t=this.multipleSelection.length,e="";this.delList=this.delList.concat(this.multipleSelection);for(var a=0;a<t;a++)e+=this.multipleSelection[a].name+" ";this.$message.error("删除了".concat(e)),this.multipleSelection=[]},handlePageChange:function(t){this.$set(this.query,"pageIndex",t),this.getData()},selectable:function(t){return!this.tableDataSelect.some((function(e){return e.hostname===t.hostname}))}}}),n=o,s=(a("c979"),a("2877")),c=Object(s["a"])(n,l,r,!1,null,"9eb9e590",null);e["default"]=c.exports}}]);