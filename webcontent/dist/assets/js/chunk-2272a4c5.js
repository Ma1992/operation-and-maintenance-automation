(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2272a4c5"],{"1f82":function(e,t,a){"use strict";t["a"]={name:"ElCol",props:{span:{type:Number,default:24},tag:{type:String,default:"div"},offset:Number,pull:Number,push:Number,xs:[Number,Object],sm:[Number,Object],md:[Number,Object],lg:[Number,Object],xl:[Number,Object]},computed:{gutter(){let e=this.$parent;while(e&&"ElRow"!==e.$options.componentName)e=e.$parent;return e?e.gutter:0}},render(e){let t=[],a={};return this.gutter&&(a.paddingLeft=this.gutter/2+"px",a.paddingRight=a.paddingLeft),["span","offset","pull","push"].forEach(e=>{(this[e]||0===this[e])&&t.push("span"!==e?`el-col-${e}-${this[e]}`:"el-col-"+this[e])}),["xs","sm","md","lg","xl"].forEach(e=>{if("number"===typeof this[e])t.push(`el-col-${e}-${this[e]}`);else if("object"===typeof this[e]){let a=this[e];Object.keys(a).forEach(s=>{t.push("span"!==s?`el-col-${e}-${s}-${a[s]}`:`el-col-${e}-${a[s]}`)})}}),e(this.tag,{class:["el-col",t],style:a},this.$slots.default)}}},"41f5":function(e,t,a){"use strict";var s=a("4c5e"),i=a.n(s);i.a},"45fc":function(e,t,a){"use strict";var s=a("23e7"),i=a("b727").some,r=a("a640"),o=a("ae40"),l=r("some"),n=o("some");s({target:"Array",proto:!0,forced:!l||!n},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"4c5e":function(e,t,a){},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,a){var s=a("1d80"),i=a("5899"),r="["+i+"]",o=RegExp("^"+r+r+"*"),l=RegExp(r+r+"*$"),n=function(e){return function(t){var a=String(s(t));return 1&e&&(a=a.replace(o,"")),2&e&&(a=a.replace(l,"")),a}};e.exports={start:n(1),end:n(2),trim:n(3)}},7156:function(e,t,a){var s=a("861d"),i=a("d2bb");e.exports=function(e,t,a){var r,o;return i&&"function"==typeof(r=t.constructor)&&r!==a&&s(o=r.prototype)&&o!==a.prototype&&i(e,o),e}},a434:function(e,t,a){"use strict";var s=a("23e7"),i=a("23cb"),r=a("a691"),o=a("50c4"),l=a("7b0b"),n=a("65f0"),c=a("8418"),p=a("1dde"),m=a("ae40"),u=p("splice"),h=m("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,d=Math.min,b=9007199254740991,g="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!u||!h},{splice:function(e,t){var a,s,p,m,u,h,_=l(this),y=o(_.length),x=i(e,y),v=arguments.length;if(0===v?a=s=0:1===v?(a=0,s=y-x):(a=v-2,s=d(f(r(t),0),y-x)),y+a-s>b)throw TypeError(g);for(p=n(_,s),m=0;m<s;m++)u=x+m,u in _&&c(p,m,_[u]);if(p.length=s,a<s){for(m=x;m<y-s;m++)u=m+s,h=m+a,u in _?_[h]=_[u]:delete _[h];for(m=y;m>y-s+a;m--)delete _[m-1]}else if(a>s)for(m=y-s;m>x;m--)u=m+s-1,h=m+a-1,u in _?_[h]=_[u]:delete _[h];for(m=0;m<a;m++)_[m+x]=arguments[m+2];return _.length=y-s+a,p}})},a9e3:function(e,t,a){"use strict";var s=a("83ab"),i=a("da84"),r=a("94ca"),o=a("6eeb"),l=a("5135"),n=a("c6b6"),c=a("7156"),p=a("c04e"),m=a("d039"),u=a("7c73"),h=a("241c").f,f=a("06cf").f,d=a("9bf2").f,b=a("58a8").trim,g="Number",_=i[g],y=_.prototype,x=n(u(y))==g,v=function(e){var t,a,s,i,r,o,l,n,c=p(e,!1);if("string"==typeof c&&c.length>2)if(c=b(c),t=c.charCodeAt(0),43===t||45===t){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:s=2,i=49;break;case 79:case 111:s=8,i=55;break;default:return+c}for(r=c.slice(2),o=r.length,l=0;l<o;l++)if(n=r.charCodeAt(l),n<48||n>i)return NaN;return parseInt(r,s)}return+c};if(r(g,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var w,k=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof k&&(x?m((function(){y.valueOf.call(a)})):n(a)!=g)?c(new _(v(t)),a,k):v(t)},S=s?h(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),$=0;S.length>$;$++)l(_,w=S[$])&&!l(k,w)&&d(k,w,f(_,w));k.prototype=y,y.constructor=k,o(i,g,k)}},c6ac:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}})],1),a("div",{staticClass:"container"},[a("el-form",{ref:"form",attrs:{inline:!0,model:e.form,rules:e.rules,"label-width":"100px"}},[a("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[a("el-form-item",{attrs:{label:"所属分类:",prop:"category"}},[a("el-select",{attrs:{placeholder:"请选择脚本所属分类"},on:{change:e.selectScriptByCategory},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},e._l(e.script_category_options,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"脚本类型:",prop:"script_type"}},[a("el-select",{attrs:{placeholder:"请选择脚本类型"},on:{change:e.selectScriptByScriptType},model:{value:e.form.script_type,callback:function(t){e.$set(e.form,"script_type",t)},expression:"form.script_type"}},e._l(e.script_type_options,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"脚本名称:",prop:"script_name"}},[a("el-select",{attrs:{placeholder:"请选择脚本"},on:{change:e.selectScriptByScriptName},model:{value:e.form.script_name,callback:function(t){e.$set(e.form,"script_name",t)},expression:"form.script_name"}},e._l(e.script_name_options,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"测试状态:",prop:"test_status"}},[a("el-input",{attrs:{clearable:""},model:{value:e.form.test_status,callback:function(t){e.$set(e.form,"test_status",t)},expression:"form.test_status"}})],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"脚本说明:",prop:"desc"}},[a("el-input",{attrs:{type:"textarea",cols:140,placeholder:"脚本描述"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"脚本参数:",prop:"param"}},[a("el-input",{attrs:{type:"textarea",cols:140,placeholder:"多个参数必须以空格间隔"},model:{value:e.form.param,callback:function(t){e.$set(e.form,"param",t)},expression:"form.param"}})],1)],1),a("div",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:"汇总:",prop:"param",labelWidth:"120"}},[e._v(" 已选 "),a("label",{staticClass:"blue"},[e._v(e._s(e.rowLength))]),e._v(" 台 ")])],1),a("el-col",{attrs:{span:9}},[a("el-button",{staticClass:"el-icon-circle-plus-outline",attrs:{type:"primary",plain:""},on:{click:e.handleAddHost}},[e._v("添加主机")]),a("el-button",{staticClass:"el-icon-caret-right",attrs:{type:"success",plain:"",disabled:e.disabled},on:{click:e.immediateExecScript}},[e._v("单机执行")]),a("el-button",{staticClass:"el-icon-s-unfold",attrs:{type:"info",plain:"",disabled:e.disabled},on:{click:e.batchExecScript}},[e._v("批量执行")]),a("el-button",{staticClass:"el-icon-time",attrs:{type:"warning",plain:"",disabled:e.disabled},on:{click:e.handleCrontab}},[e._v("定时执行")])],1)],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataSelect,border:"","max-height":"600"}},[a("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),a("el-table-column",{attrs:{prop:"hostname",label:"主机名称",align:"center"}}),a("el-table-column",{attrs:{prop:"network_ip",label:"内网IP",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"类型",align:"center"}}),a("el-table-column",{attrs:{prop:"username",label:"用户名",align:"center"}}),a("el-table-column",{attrs:{prop:"password",label:"密码",formatter:e.formatPwd,align:"center"}}),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),a("el-dialog",{attrs:{title:"添加主机",visible:e.addHostVisible,width:"70%"},on:{"update:visible":function(t){e.addHostVisible=t}}},[a("el-form",{ref:"host_form",attrs:{inline:!0,model:e.host_form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择主机:",prop:"room_type"}},[a("el-select",{attrs:{placeholder:"机房分类",clearable:""},model:{value:e.host_form.room_type,callback:function(t){e.$set(e.host_form,"room_type",t)},expression:"host_form.room_type"}},e._l(e.room_type_options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.label}})})),1)],1),a("el-form-item",[a("el-input",{staticStyle:{width:"200px","margin-bottom":"15px"},attrs:{type:"text",placeholder:"请输入主机名",clearable:""},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}})],1),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","max-height":"600"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",selectable:e.selectable}}),a("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),a("el-table-column",{attrs:{prop:"hostname",label:"主机名称",align:"center"}}),a("el-table-column",{attrs:{prop:"network_ip",label:"内网IP",align:"center"}}),a("el-table-column",{attrs:{prop:"operate_system",label:"系统类型",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"类型",align:"center"}}),a("el-table-column",{attrs:{prop:"username",label:"用户名",align:"center"}}),a("el-table-column",{attrs:{prop:"password",label:"密码",formatter:e.formatPwd,align:"center"}}),a("el-table-column",{attrs:{prop:"ssh_port",label:"端口",align:"center"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addHostVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addHost}},[e._v("添 加")])],1)],1),a("el-dialog",{attrs:{title:"定时任务",visible:e.CrontabVisible,width:"55%"},on:{"update:visible":function(t){e.CrontabVisible=t}}},[a("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"选择执行方式：",prop:"exec_type"}},[a("el-select",{staticStyle:{width:"320px"},attrs:{placeholder:"请选择任务执行方式"},model:{value:e.form.exec_type,callback:function(t){e.$set(e.form,"exec_type",t)},expression:"form.exec_type"}},e._l(e.exec_type_options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.label}})})),1)],1),"定时执行"===e.form.exec_type?a("el-form-item",{attrs:{label:"选择执行时间：",prop:"exec_time"}},[a("el-date-picker",{staticStyle:{width:"320px"},attrs:{type:"datetime",placeholder:"请选择任务执行时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.form.exec_time,callback:function(t){e.$set(e.form,"exec_time",t)},expression:"form.exec_time"}})],1):e._e(),"周期性执行"===e.form.exec_type?a("el-form-item",{attrs:{label:"输入执行时间：",prop:"cron_exec_time"}},[a("el-input",{staticStyle:{width:"320px"},attrs:{placeholder:"请输入执行时间"},on:{blur:e.checkDate},model:{value:e.form.cron_exec_time,callback:function(t){e.$set(e.form,"cron_exec_time",t)},expression:"form.cron_exec_time"}}),a("el-row",{staticClass:"cron_time_color"},[e._v("格式:分 时 日 月 年,以空格间隔")]),a("el-row",{staticClass:"cron_exec_time"},[a("el-col",[e._v("周期性执行执行时间采用Cron表达式:")]),a("ul",[a("li",[e._v("逗号（“ , “）分开的值，例如：“1,3,4,7,8”")]),a("li",[e._v("连词符（“ - “）指定值的范围，例如：“1-6”，意思等同于“1,2,3,4,5,6”")]),a("li",[e._v("星号（“ * “）代表任何可能的值。例如，在“小时域”里的星号等于是“每一个小时”")]),a("li",[e._v("斜线（“ / “）操作符，用于表示跳过某些给定的数。例如，“*/3”在小时域中等于“0,3,6,9,12,15,18,21”等被3整除的数")])])],1)],1):e._e(),"周期性执行"===e.form.exec_type?a("el-form-item",{attrs:{label:"每周几执行：",prop:"exec_week"}},[a("el-input",{staticStyle:{width:"320px"},attrs:{placeholder:"星期（0-6 或者 mon，tue，wed，thu，fri，sat，sun）"},model:{value:e.form.exec_week,callback:function(t){e.$set(e.form,"exec_week",t)},expression:"form.exec_week"}})],1):e._e(),"轮巡执行"===e.form.exec_type?a("el-form-item",{attrs:{label:"输入执行时间：",prop:"interval_exec_time"}},[a("el-input",{staticStyle:{width:"320px"},attrs:{placeholder:"请输入执行时间"},on:{blur:e.checkTime},model:{value:e.form.interval_exec_time,callback:function(t){e.$set(e.form,"interval_exec_time",t)},expression:"form.interval_exec_time"}}),a("el-col",{staticClass:"cron_time_color"},[e._v("格式:时/分/秒,以(/)间隔")])],1):e._e(),"定时执行"!==e.form.exec_type?a("el-form-item",{attrs:{label:"选择开始时间：",prop:"start_time"}},[a("el-date-picker",{staticStyle:{width:"320px"},attrs:{type:"datetime",placeholder:"请选择任务开始时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.form.start_time,callback:function(t){e.$set(e.form,"start_time",t)},expression:"form.start_time"}})],1):e._e(),"定时执行"!==e.form.exec_type?a("el-form-item",{attrs:{label:"选择结束时间：",prop:"end_time"}},[a("el-date-picker",{staticStyle:{width:"320px"},attrs:{type:"datetime",placeholder:"请选择任务结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.form.end_time,callback:function(t){e.$set(e.form,"end_time",t)},expression:"form.end_time"}})],1):e._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.CrontabVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.timingExecScript}},[e._v("确 定")])],1)],1),a("el-dialog",{staticClass:"row-bg",attrs:{title:"单机执行",visible:e.immediateExecVisible,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(t){e.immediateExecVisible=t}}},e._l(e.scriptMessage,(function(t){return a("el-row",{key:t},[a("el-col",{staticStyle:{"margin-top":"10px"},attrs:{span:24}},[a("span",[e._v(e._s(t))])])],1)})),1),a("el-dialog",{attrs:{title:"批量执行",visible:e.ExecVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.ExecVisible=t}}},[a("el-row",{staticClass:"handle-box"},[a("el-col",{staticClass:"center",attrs:{span:6}},[a("div",[a("i",{staticClass:"el-icon-document",staticStyle:{"font-size":"80px","font-weight":"bold"}})]),a("div",[a("label",{staticClass:"blue"},[e._v(e._s(this.form.script_name))])])]),a("el-col",{attrs:{span:9}},[a("div",[e._v(" 执 行 人："+e._s(this.username)+" ")]),a("div",[e._v(" 脚本类型："+e._s(this.form.script_type)+" ")]),a("div",[e._v(" 脚本参数："+e._s(this.form.param)+" ")]),a("div",[e._v(" 执行主机：共 "),a("label",{staticClass:"blue"},[e._v(e._s(e.rowLength))]),e._v(" 台 ")])]),a("el-col",{attrs:{span:9}},[a("div",[e._v(" 开始时间: "+e._s(this.startFormatDate)+" ")]),a("div",[e._v(" 结束时间: "+e._s(this.endFormatDate)+" ")])])],1),a("el-table",{attrs:{data:this.scriptLogMessage}},[a("el-table-column",{attrs:{property:"hostname",label:"主机名称",width:"200"}}),a("el-table-column",{attrs:{property:"network_ip",label:"内网IP"}}),a("el-table-column",{attrs:{property:"username",label:"账户"}}),a("el-table-column",{attrs:{property:"execute_res",label:"执行结果"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.execute_res?a("div",["执行中"===t.row.execute_res?a("el-tag",[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.row.execute_res,placement:"top-start"}},[a("span",[e._v("执行中")])])],1):e._e(),"已完成"===t.row.execute_res?a("el-tag",{attrs:{type:"success"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.row.execute_res,placement:"top-start"}},[a("span",[e._v("已完成")])])],1):e._e(),"执行失败"===t.row.execute_res.substr(0,4)?a("el-tag",{attrs:{type:"danger"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.row.execute_res,placement:"top-start"}},[a("span",[e._v("执行失败")])])],1):e._e()],1):e._e()]}}])})],1)],1)],1)},i=[],r=(a("99af"),a("c975"),a("d81d"),a("45fc"),a("a434"),a("b0c0"),a("a9e3"),a("d3b7"),a("25f0"),a("1f82")),o=a("424b"),l={components:{ElCol:r["a"]},name:"roletable",data:function(){return{options:[],script_type_options:[],script_category_options:[],script_name_options:[],room_type_options:[{value:"选项1",label:"公司机房"},{value:"选项2",label:"外部机房"}],exec_type_options:[{value:"选项1",label:"定时执行"},{value:"选项2",label:"周期性执行"},{value:"选项3",label:"轮巡执行"}],addHostVisible:!1,CrontabVisible:!1,ExecVisible:!1,immediateExecVisible:!1,network_ip_option:[],menuProps:{value:"id",label:"name",multiple:!0},keywords:"",query:{address:"",name:"",pageIndex:1,pageSize:10},tableData:[],tableDataSelect:[],multipleSelection:[],delList:[],disabled:!0,loading:!0,title:"",name:"",startFormatDate:"",endFormatDate:"",scriptLogMessage:{execute_res:""},wsUrl:"",scriptMessage:[],pageTotal:0,form:{username:"",exec_type:"",exec_time:"",cron_exec_time:"",interval_exec_time:"",exec_week:"",start_time:"",end_time:""},host_form:{},host:{},idx:-1,id:-1,rules:{category:[{required:!0,message:"请选择脚本所属分类",trigger:"change"}],script_type:[{required:!0,message:"请选择脚本类型",trigger:"change"}],script_name:[{required:!0,message:"请选择脚本",trigger:"change"}],exec_type:[{required:!0,message:"请选择任务执行方式",trigger:"change"}],exec_time:[{required:!0,message:"请选择任务执行时间",trigger:"change"}],cron_exec_time:[{required:!0,message:"请输入任务执行时间",trigger:"change"}],interval_exec_time:[{required:!0,message:"请输入任务执行时间",trigger:"change"}]},rowLength:0}},created:function(){this.token=localStorage.getItem("token"),this.username=localStorage.getItem("username"),this.getScriptName()},methods:{formatPwd:function(e){if(e.password)return"******"},getData:function(){var e=this,t=this.keywords,a=this.url;a=t?"asset/api/network/network_type?hostname=".concat(t):"asset/api/network/network_type/",this.$http.get(a,{headers:{token:this.token}}).then((function(t){e.tableData=t.data,e.loading=!1})).catch((function(t){e.$message.error(JSON.stringify(t.response.data)),e.loading=!1}))},getNetworkIp:function(e){var t=this;this.$http.get("asset/api/network/network_type?hostname=".concat(e.hostname),{headers:{token:this.token}}).then((function(e){t.network_ip_option=e.data[0]["network_ip"]})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))},getScriptName:function(){var e=this;this.$http.get("automation/api/script/?use=0",{headers:{token:this.token}}).then((function(t){var a=t.data,s=[],i=[],r=[];a.map((function(e){s.push(e.script_name),-1===i.indexOf(e.script_type)&&i.push(e.script_type),-1===r.indexOf(e.category)&&r.push(e.category)})),e.script_name_options=s,e.script_type_options=i,e.script_category_options=r})).catch((function(t){e.$message.error(JSON.stringify(t.response.data))}))},selectScriptByCategory:function(e){var t=this;this.$http.get("automation/api/script?use=0&category=".concat(e),{headers:{token:this.token}}).then((function(e){var a=e.data,s=[];a.map((function(e){-1===s.indexOf(e.script_type)&&s.push(e.script_type)})),t.script_type_options=s})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))},selectScriptByScriptType:function(e){var t=this,a=this.url;a=this.form.category?"automation/api/script?use=0&category=".concat(this.form.category,"&scrip_type=").concat(e):"automation/api/script?use=0&scrip_type=".concat(e),this.$http.get(a,{headers:{token:this.token}}).then((function(e){var a=e.data,s=[];a.map((function(e){-1===s.indexOf(e.script_name)&&s.push(e.script_name)})),t.script_name_options=s})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))},selectScriptByScriptName:function(e){var t=this;this.$http.get("automation/api/script?use=0&name=".concat(e),{headers:{token:this.token}}).then((function(e){e.data[0].exec_type="",t.form=e.data[0]})).catch((function(e){t.$message.error(JSON.stringify(e.response.data))}))},handleAddHost:function(){this.addHostVisible=!0,this.getData()},addHost:function(){0===this.multipleSelection.length?this.$message.warning("请选择要添加的主机！"):(0===this.tableDataSelect.length?this.tableDataSelect=this.multipleSelection:this.tableDataSelect=this.tableDataSelect.concat(this.multipleSelection),this.addHostVisible=!1,this.disabled=!1,this.rowLength=this.tableDataSelect.length)},handleSearch:function(){this.$set(this.query,"pageIndex",1),this.getData()},handleDelete:function(e){this.tableDataSelect.splice(e,1),0===this.tableDataSelect.length&&(this.disabled=!0),this.rowLength=this.tableDataSelect.length},handleSelectionChange:function(e){this.multipleSelection=e},initWebSocket:function(){console.log("wsUrl",this.wsUrl),null==this.websocket&&(this.websocket=new WebSocket(this.wsUrl)),this.websocket.onerror=this.setErrorMessage,this.websocket.onopen=this.setOnopenMessage,this.websocket.onmessage=this.setOnmessageMessage,this.websocket.onclose=this.setOncloseMessage,window.onbeforeunload=this.onbeforeunload},setErrorMessage:function(){console.log("WebSocket连接发生错误   状态码："+this.websocket.readyState)},setOnopenMessage:function(){if(this.wsUrl===this.globalAPI.websocketUrl+"ws/immediate_exec_script/"){var e=this.form;this.websocket.send(JSON.stringify(e)),console.log("WebSocket连接成功    状态码："+this.websocket.readyState+e)}else console.log("WebSocket连接成功    状态码："+this.websocket.readyState)},setOnmessageMessage:function(e){console.log("event",e.data);var t="";try{t=JSON.parse(e.data),this.scriptLogMessage=t}catch(a){t=e.data,this.scriptMessage.push(t)}},setOncloseMessage:function(){console.log("WebSocket连接关闭    状态码："+this.websocket.readyState),this.closeWebSocket(),this.endFormatDate=Object(o["getFormatDate"])(),this.websocket=null},onbeforeunload:function(){this.closeWebSocket()},closeWebSocket:function(){this.websocket.close()},genID:function(e){return Number(Math.random().toString().substr(3,e)+Date.now()).toString(36)},immediateExecScript:function(){this.form.script_name?this.tableDataSelect.length>1?this.$message.warning("单机执行，只能选择一台主机！"):(this.form.host_info=this.tableDataSelect,this.form.uuid=this.genID(),this.form.username=this.username,this.scriptMessage=[],this.immediateExecVisible=!0,this.wsUrl=this.globalAPI.websocketUrl+"ws/immediate_exec_script/",this.initWebSocket()):this.$message.warning("请选择脚本名称！")},batchExecScript:function(){var e=this;this.form.script_name?(this.form.host_info=this.tableDataSelect,this.form.uuid=this.genID(),this.scriptLogMessage=this.tableDataSelect,this.startFormatDate=Object(o["getFormatDate"])(),this.endFormatDate="--",this.ExecVisible=!0,this.wsUrl=this.globalAPI.websocketUrl+"ws/executing_script?uuid=".concat(this.form.uuid),this.initWebSocket(),this.$http.post("automation/api/script/exec_script/",this.form,{headers:{token:this.token,username:this.username}}).then((function(t){e.$message.success(t.data.msg)})).catch((function(t){e.$message.error(JSON.stringify(t.response.data))}))):this.$message.warning("请选择脚本名称！")},handleCrontab:function(){this.form.script_name?(this.CrontabVisible=!0,this.form.exec_type="定时执行"):this.$message.warning("请选择脚本名称！")},checkDate:function(){var e=/^([0-9-,/*]+)\s([0-9-,/*]+)\s([0-9-,/*]+)\s([0-9-,/*]+)\s([0-9-,/*]+)$/;return!1!==e.test(this.form.cron_exec_time)||(this.$message.warning("执行时间格式不正确！"),!1)},checkTime:function(){var e=/^([0-1]?[0-9]|2[0-3])\/([0-5][0-9])\/([0-5][0-9])$/;return!1!==e.test(this.form.interval_exec_time)||(this.$message.warning("执行时间格式不正确！"),!1)},timingExecScript:function(){var e=this;if("定时执行"!==this.form.exec_type){var t=this.execEndDatetimeFormat(this.form.end_time),a=this.execEndDatetimeFormat(Object(o["getFormatDate"])());if(this.form.end_time&&t<a)return void this.$message.warning("结束时间小于当前时间，请重新选择！");if("周期性执行"===this.form.exec_type){if(!1===this.checkDate())return}else if("轮巡执行"===this.form.exec_type&&!1===this.checkTime())return}this.form.host_info=this.tableDataSelect,this.form.uuid=this.genID(),this.$refs.form.validate((function(t){if(!t)return e.$message.warning("请选择必填项"),!1;e.$http.post("automation/api/script/timing_exec_script/",e.form,{headers:{token:e.token,username:e.username}}).then((function(t){e.CrontabVisible=!1,e.$message.success(t.data.msg)})).catch((function(t){e.$message.error(JSON.stringify(t.response.data))}))}))},execEndDatetimeFormat:function(e){if(null!=e){var t=new Date(e);return t.getTime()}},delAllSelection:function(){var e=this.multipleSelection.length,t="";this.delList=this.delList.concat(this.multipleSelection);for(var a=0;a<e;a++)t+=this.multipleSelection[a].name+" ";this.$message.error("删除了".concat(t)),this.multipleSelection=[]},handlePageChange:function(e){this.$set(this.query,"pageIndex",e),this.getData()},selectable:function(e){return!this.tableDataSelect.some((function(t){return t.hostname===e.hostname}))}}},n=l,c=(a("41f5"),a("2877")),p=Object(c["a"])(n,s,i,!1,null,"5e465949",null);t["default"]=p.exports},d81d:function(e,t,a){"use strict";var s=a("23e7"),i=a("b727").map,r=a("1dde"),o=a("ae40"),l=r("map"),n=o("map");s({target:"Array",proto:!0,forced:!l||!n},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);